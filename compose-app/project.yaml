imports:
  - ../properties/root.yaml
  - ../properties/kotlin/mpp/mpp.yaml
  - ../properties/kotlin/targets/jvm/jvm.yaml
  - ../properties/android/android-application.yaml
  - ../properties/kotlin/targets/native/apple/ios.yaml
  - ../properties/kotlin/targets/web/js/js-executable.yaml
  - ../properties/kotlin/targets/web/wasmJs/wasm-js-executable.yaml
  - ../properties/kotlin/mpp/mpp-hierarchy-template.yaml
  - ../properties/kotlin/targets/native/apple/cocoapods.yaml
  - ../properties/kotlin/targets/jvm-android.yaml
  - ../properties/kotlin/targets/native/apple/apple-common.yaml
  - ../properties/kotlin/targets/native/native-common.yaml
  - ../properties/kotlin/targets/android-ios.yaml
  - ../properties/kotlin/targets/android-ios-web.yaml
  - ../properties/kotlin/targets/jvm-android-ios.yaml
  - ../properties/kotlin/targets/web/web.yaml
  - ../properties/kotlin/targets/jvm-web.yaml
  - ../properties/compose.yaml
  - ../properties/android/android-application-compose.yaml
  - ../properties/subproject.yaml
config:
  imports:
    - org.jetbrains.compose.desktop.application.dsl.TargetFormat
description: Compose Multiplatform application.
script:
  - plugins:
      - id: (libs.plugins("compose.hotReload").pluginId)
  - kotlin:
      cocoapods:
        - podfile: file("../appleApp/Podfile")
        # https://youtrack.jetbrains.com/issue/KT-41830/
        # Only link against pods the library (lorem-ipsum and google-maps) depends on.
        - pod: |
            ("shared") {
              version = rootProject.subprojects.find { project -> project.name == "shared" }!!.version.toString()
              linkOnly = true
            }
        - framework: |
            {
              // Required properties
              // Framework name configuration. Use this property instead of deprecated 'frameworkName'
              baseName = moduleName

              // Optional properties
              // Specify the framework linking type. It's dynamic by default.
              isStatic = true
              // Dependency export
              // Uncomment and specify another project module if you have one:
                // export(project(":<your other KMP module>"))
                transitiveExport = false // This is default.
            }
      sourceSets:
        - named: |
            ("commonMain") { sourceSet ->
              sourceSet.dependencies {
                implementation(project(":shared"))
              }
            }
  - compose:
      desktop:
        application:
          mainClass: '"MainKt"'
          jvmArgs.addAll: |
            (listOf(
              "--add-opens=java.desktop/sun.awt=ALL-UNNAMED",
              "--add-opens=java.desktop/java.awt.peer=ALL-UNNAMED",
              // For mac.
              "--add-opens=java.desktop/sun.lwawt=ALL-UNNAMED",
              "--add-opens=java.desktop/sun.lwawt.macosx=ALL-UNNAMED",
            ))
          nativeDistributions:
            targetFormats: setOf(TargetFormat.Dmg, TargetFormat.Msi, TargetFormat.Deb)
            packageName: group.toString()
            packageVersion: libs.versions("compose.desktop.packageVersion").requiredVersion
            description: description
            copyright: '"Â© ${settings.settingsScript.year} - ${settings.settingsScript.developer.name}. All rights reserved."'
            vendor: '"Example vendor"'
            licenseFile: (file("LICENSE.txt"))
            appResourcesRootDir: project.layout.projectDirectory.dir("resources")
          buildTypes:
            release:
              proguard:
                configurationFiles.from: (file("compose-desktop.pro"))
                obfuscate: true
