spotlessExclude: [
  '**/generated-src/**',
  '**/build-*/**',
  '**/.idea/**',
  '**/.fleet/**',
  '**/.idea/**',
  '**/.gradle/**',
  '/spotless/**',
  '**/resources/**',
  '**/buildSrc/**' ]

layout: FLAT

group: io.github.aaziz993

plugins:
  # Can format <antlr | c | c# | c++ | css | flow | graphql | groovy | html | java | javascript | json | jsx | kotlin | less | license headers | markdown | objective-c | protobuf | python | scala | scss | shell | sql | typeScript | vue | yaml | anything> using <gradle | maven | sbt | anything>.
  spotless:
    enabled: true
    formats:
      - java:
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.java
            delimiter: '(package|import|public|class|module) '
          # include source files
          targets: [ '**/*.java' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.java ]
          # uses the default importOrder configuration
          importOrder:
            importOrder: [ ]
          # removes any unused imports from any of your Java classes
          removeIfUnusedImports: true
          # Tells spotless to format according to the Google Style Guide
          # (https://google.github.io/styleguide/javaguide.html)
          googleJavaFormat:
            groupArtifact: com.google.googlejavaformat:google-java-format
            reflowLongStrings: true
            reorderImports: true
            formatJavadoc: false
          # fixes formatting of type annotations
          formatAnnotations: { }
          # cleanthat will refactor your code, but it may break your style: apply it before your formatter
          cleanthat: { }
      - kotlin:
          # use ktlint with version and custom .editorconfig
          ktlint:
            editorConfigPath: ../.editorconfig
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.kt
            delimiter: (package |@file|import )
          # include source files
          targets: [ '**/*.kt','**/*.kts' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.kt ]
          # removes any unused imports from any of your Java classes
          removeIfUnusedImports: true
      - kotlinGradle:
          # use ktlint with version and custom .editorconfig
          ktlint:
            editorConfigPath: ../.editorconfig
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.kt
            delimiter: (package |@file|import )
          # include source files
          targets: [ '**/*.gradle.kts' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.kt ]
          # removes any unused imports from any of your Java classes
          removeIfUnusedImports: true
      - javascript:
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.js
            delimiter: ^
          # include source files
          target: [ '**/*.js' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.js ]
      - typescript:
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.ts
            delimiter: ^
          # include source files
          target: [ '**/*.ts' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.ts ]
      - json:
          # include source files
          target: [ '**/*.json' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.json ]
      - yaml:
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.yaml
            delimiter: ^
          # include source files
          target: [ '**/*.yaml', '**/*.yml' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.yaml ]
      - format:
          name: xml
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.xml
            delimiter: <(\?xml)?
          # include source files
          target: [ '**/*.xml' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.xml ]
      - format:
          name: properties
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.properties
            delimiter: ^
          # include source files
          target: [ '**/*.properties' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.properties ]
          # removes any extra whitespace at the beginning of lines
          indentIfWithSpaces: true
      - format:
          name: html
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.html
            delimiter: <(!DOCTYPE |html )
          # include source files
          target: [ '**/*.html' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.html ]
      - format:
          name: md
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.md
            delimiter: ^
          # include source files
          target: [ '**/*.md' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.md ]
      - format:
          name: gitignore
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.gitignore
            delimiter: ^
          # include source files
          target: [ '**/.gitignore' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.gitignore ]
      - format:
          name: gitattributes
          # specify license header text
          licenseHeader:
            headerFile: ../LICENSE_HEADER.gitattributes
            delimiter: ^
          # include source files
          target: [ '**/.gitattributes' ]
          # exclude source files
          targetExclude: [ ../LICENSE_HEADER.gitattributes ]
      - format:
          # removes any extra whitespace at the end of lines
          trimTrailingWhitespace: true
          # adds a newline character to the end of files content
          endWithNewline: true
          # adds the ability to have spotless ignore specific portions of a project. The usage looks like the following
          toggleIfOffOn: true

  # Set of solutions for collecting test coverage of Kotlin code compiled for JVM and Android platforms.
  kover:
    enabled: true
    useJacoco: true
    reports:
      total:
        html:
          title: Generate coverage report
          htmlDir: build/reports/kover
          onCheck: true
          charset: UTF8
        xml:
          xmlFile: build/reports/kover/report.xml
          onCheck: true

  # Help developers deliver high-quality, efficient code standards that benefit the entire team or organization.
  sonar:
    enabled: true
    properties:
      sonar.host.url: https://sonarcloud.io
      sonar.organization: aaziz993
      sonar.projectKey: aaziz993_compose-multiplatform
      sonar.coverage.jacoco.xmlReportPaths: build/reports/kover/report.xml
      sonar.androidLint.reportPaths: build/reports/lint-results.xml

  # api documentation engine for Kotlin.
  dokka:
    enabled: true
    dokkaSourceSets:
      - '':
          includes: [ README.md ]
    pluginsConfiguration:
      - html:
          customStyleSheets: [ ../dokka/style.css, ../dokka/prism.css, ../dokka/logo-styles.css ]
          customAssets: [ dokka/logo-icon.svg ]
          footerMessage: Â© 2025 - Aziz Atoev
          templatesDir: documentation
      - versioning:
          olderVersionsDir: documentation/version

  # produces Kotlin source example files and tests from markdown documents with embedded snippets of Kotlin code
  knit:
    moduleDocs: build/dokka

  # allows dumping binary API of a JVM part of a Kotlin library that is public in the sense of Kotlin visibilities and ensures that the public binary API wasn't changed in a way that makes this change binary incompatible.
  apiValidation:
    enabled: true
    apiDumpDirectory: api-validation
    klib:
      enabled: true
      strictValidation: true

  # check (JDK, android SDK or any library) API compatibility for java (kotlin, scala, groovy etc.), android and kotlin multiplatform projects.
  animalSniffer:
    enabled: true
    debug: true
    ignoreFailures: true

  # publishing
  publishing:
    repositories:
      - mavenLocal: { }
      - maven:
          name: GithubPackages
          url: https://maven.pkg.github.com/aaziz993
          credentials:
            username: aaziz993
            password: $envOrLocal.github.password
      - maven:
          name: SpacePackages
          url: https://maven.pkg.jetbrains.space/aaziz93/p/aaziz-93/maven
          credentials:
            username: aaziz93
            password: $envOrLocal.jetbrains.space.password
    publications:
      - maven:
          pom:
            inceptionYear: '2025'
            licenses:
              - name: Apache License, Version 2.0
                url: https://www.apache.org/licenses/LICENSE-2.0.txt
                distribution: repo
                comments: A business-friendly OSS license.
            issueManagement:
              system: GitHub Issues
              url: https://github.com/aaziz993/compose-multiplatform/issues
            developers:
              - id: aaziz993
                name: Aziz Atoev
                email: a.atoev93@gmail.com
                organization: AITech
                organizationUrl: https://github.com/aaziz993
            scm:
              url: https://github.com/aaziz993/compose-multiplatform
              connection: scm:git:git://github.com:aaziz993/compose-multiplatform.git
              developerConnection: scm:git:ssh://github.com:aaziz993/compose-multiplatform.git
              tag: HEAD

  # api that you can use to develop lightweight compiler plugins. KSP provides a simplified compiler plugin API that leverages the power of Kotlin while keeping the learning curve at a minimum. Compared to KAPT, annotation processors that use KSP can run up to 2x faster.
  ksp:
    enabled: true
    useKsp2: true

  # Generating BuildConstants for any kind of Gradle projects: Java, Kotlin, Android, Groovy, etc. Designed for KTS scripts, with experimental support for Kotlin's multi-platform plugin
  buildConfig:
    enabled: true

  # adapts Kotlin to the requirements of those frameworks and makes classes annotated with a specific annotation and their members open
  allOpen:
    enabled: true
    myAnnotations:
      - javax.ws.rs.Path
      - javax.enterprise.context.ApplicationScoped
      - javax.persistence.Entity
      - data.type.annotation.AllOpen

  # generates an additional zero-argument constructor for classes with a specific annotation.
  noArg:
    myAnnotations:
      - data.type.annotation.NoArg

  # compiler plugin, that generates visitor code for serializable classes, runtime library with core serialization API and support libraries with various serialization formats.
  serialization:
    enabled: true
    version: 1.8.0

  # multiplatform library that provides the idiomatic and efficient way of using atomic operations in Kotlin.
  atomicFU:
    enabled: true

  # generates typesafe Kotlin APIs from your SQL statements. It verifies your schema, statements, and migrations at compile-time and provides IDE features like autocomplete and refactoring which make writing and maintaining SQL simple.
  sqldelight:
    linkSqlite: true

  # abstraction layer over SQLite to allow for more robust database access while harnessing the full power of SQLite.
  room:
    enabled: true
    schemaDirectories:
      - schemas

  # kotlin library for adding asynchronous Remote Procedure Call (RPC) services to your applications. Build your RPC with already known language constructs and nothing more!
  rpc:
    enabled: true
    annotationTypeSafetyEnabled: true

  # http client/Kotlin Symbol Processor for Kotlin Multiplatform ( Android, iOS, Js, Jvm, Linux) using KSP and Ktor clients inspired by Retrofit
  ktorfit:
    enabled: true
    generateQualifiedTypeName: true

  # strongly typed GraphQL client that generates Kotlin models for your GraphQL operations.
  apollo:
    enabled: true
    generateSourcesDuringGradleSync: true

  # providing detailed failure messages with contextual information during testing.
  powerAssert:
    enabled: true
    functions:
      - kotlin.assert
      - kotlin.test.assertTrue
      - kotlin.test.assertEquals
      - kotlin.test.assertNull
      - kotlin.test.assertFails
      - kotlin.test.assertFailsWith

    includedSourceSets:
      - commonMain
      - jvmMain
      - androidMain
      - nativeMain
      - jsMain
      - wasmJsMain

buildscript:
  repositories:
    - mavenCentral

kotlin:
  explicitApi: Strict

  targets:
    - '':
        compilerOptions:
          allWarningsAsErrors: false
          debug: false
          progressiveMode: true
          suppressWarnings: false
          verbose: true
          languageFeatures:
            - ContextReceivers
            - ExplicitBackingFields
          freeCompilerArgs:
            - -Xignore-const-optimization-errors
            - -Xexplicit-api=strict
            - -Xexport-kdoc
            - -Xinline-classes
            - -Xwhen-guards
            - -Xnon-local-break-continue
            - -Xexpect-actual-classes
            - -Xcontext-receivers
            - -Xmulti-dollar-interpolation
            - -Xrender-internal-diagnostic-names
          optIns:
            - kotlin.RequiresOptIn, kotlin.ExperimentalSubclassOptIn
            - kotlin.ExperimentalStdlibApi
            - kotlin.ExperimentalUnsignedTypes
            - kotlin.ExperimentalUuidApi
            - kotlin.time.ExperimentalTime
            - kotlin.contracts.ExperimentalContracts
            - kotlin.experimental.ExperimentalObjCName
            - kotlin.js.ExperimentalJsExport
            - kotlinx.coroutines.ExperimentalCoroutinesApi
            - kotlinx.coroutines.DelicateCoroutinesApi
            - kotlinx.coroutines.FlowPreview
            - kotlinx.serialization.ExperimentalSerializationApi
            - kotlinx.serialization.InternalSerializationApi
            - dev.whyoleg.cryptography.DelicateCryptographyApi
    - jvmCommon:
        compilerOptions:
          freeCompilerArgs:
            - -Xjvm-default=all

dependencies:
  - kspCommonMainMetadata: $libs.arrow.optics.ksp.plugin
  - kspCommonMainMetadata: $libs.androidx.room.compiler
  - kspCommonMainMetadata: $libs.ktorfit.ksp
    # Use import org.koin.ksp.generated.*
  - kspCommonMainMetadata: $libs.koin.ksp.compiler
  # animalsniffer java signatures
  - signature: $libs.signature.java
  - signature: $libs.signature.android

tasks:

  - KnitTask:
      dependsOn: [ dokkaGenerate ]
#  - Jar:
#      name: sourcesJar
#      archiveClassifier: sources
#      from: sources
#  - Jar:
#      name: javadocJar
#      archiveClassifier: javadoc
  - ShadowJar:
      duplicatesStrategy: EXCLUDE
      mergeServiceFiles: true

localPropertiesFile: ../local.properties
