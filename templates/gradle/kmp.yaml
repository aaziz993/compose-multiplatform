kotlin:
  targets:
    - iosArm64
    - iosX64
    - iosSimulatorArm64
    # apply to all above native targets
    - native:
        compilerOptions:
          optIns:
            - kotlin.experimental.ExperimentalObjCName
            - kotlin.experimental.ExperimentalNativeApi
            - kotlinx.cinterop.ExperimentalForeignApi
            - kotlinx.cinterop.BetaInteropApi
            - kotlinx.cinterop.UnsafeNumber
          freeCompilerArgs:
            - -Xexport-kdoc
            - -Xallocator=custom
            - -XXLanguage+ImplicitSignedToUnsignedIntegerConversion
            - -Xadd-light-debug=enable
        binaries:
          - framework:
              # add it to avoid sqllite3 issues in iOS. Required when using NativeSQLiteDriver
              linkerOpts:
                - -lsqlite3
          - testExecutable:
              buildTypes: [ RELEASE ]
    - nativeWithTests:
        testRuns:
          - releaseTest:
              executionSourceFrom: RELEASE

    # apply to all above js and wasm targets
    - jsCommon:
        devServer:
          static:
            # serve sources to debug inside browser
            - ../ # root directory
            - ./ # project directory

        compilerOptions:
          optIns:
            - kotlin.js.ExperimentalJsExport
        browser:
          commonWebpackConfig:
            cssSupport:
              enabled: true
          testTask:
            testLogging:
              showStandardStreams: true
            useKarma:
              configDirectory: ../karma.config.d
              useChromeHeadless: true
        nodejs:
          testTask:
            useMocha:
              timeout: 600s

  hierarchy:
    common:
      groups:
        - jvmCommon: [ jvm, android ]
        - jvmCommonIos: [ jvmCommon, ios ]
        - jvmIosWeb: [ jvm, ios, web ]
        - jvmWeb: [ jvm, web ]
        - androidIos: [ android, ios ]
        - androidIosWeb: [ mobile, web ]
        - androidNative32: [ androidNativeArm32,androidNativeX86 ]
        - androidNative64: [ androidNativeX64, androidNativeArm64 ]
        - androidNative: [ androidNative32, androidNative32 ]
        - apple32: [ watchosArm32, watchosArm64 ] # NB watchosArm64 is weird target w/ 32-bit numbers.
        - apple64: [ ios, macos, tvos, watchosX64, watchosDeviceArm64, watchosSimulatorArm64 ]
        - apple: [ apple32, apple64 ]
        - nonIos: [ jvmCommon, web ]
        - nix: [ linux, apple, androidNative ]
        - posix: [ mingw, nix ]
        - nativeNonApple: [ mingw, unix, linux, androidNative ]
        - nativeNonAndroid: [ apple, mingw, linux ]
        - native: [ nativeNonApple, nativeNonAndroid ]
        - desktop: [ linux, windows, macos ]
        - multithreaded: [ jvmCommon, native ]
        - jsCommon: [ js, wasmJs ]
        - wasm: [ wasmJs, wasmWasi ]
        - web: [ jsCommon, wasmWasi ]

  #  sourceSets:

  cocoapods:
    ios: { }
