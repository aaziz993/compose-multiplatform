kotlin:
  targets:
    - iosArm64
    - iosX64
    - iosSimulatorArm64
    # apply to all above native targets
    - native:
        compilerOptions:
          optIns:
            - kotlin.experimental.ExperimentalObjCName
            - kotlin.experimental.ExperimentalNativeApi
            - kotlinx.cinterop.ExperimentalForeignApi
            - kotlinx.cinterop.BetaInteropApi
            - kotlinx.cinterop.UnsafeNumber
          freeCompilerArgs:
            - -Xexport-kdoc
            - -Xallocator=custom
            - -XXLanguage+ImplicitSignedToUnsignedIntegerConversion
            - -Xadd-light-debug=enable
        binaries:
          - framework:
              # add it to avoid sqllite3 issues in iOS. Required when using NativeSQLiteDriver
              linkerOpts:
                - -lsqlite3
          - testExecutable:
              buildTypes: [ RELEASE ]
    - nativeWithTests:
        testRuns:
          - releaseTest:
              executionSourceFrom: RELEASE

    # apply to all above js and wasm targets
    - jsCommon:
        devServer:
          static:
            # serve sources to debug inside browser
            - ../ # root directory
            - ./ # project directory

        compilerOptions:
          optIns:
            - kotlin.js.ExperimentalJsExport
        browser:
          commonWebpackConfig:
            cssSupport:
              enabled: true
          testTask:
            testLogging:
              showStandardStreams: true
            useKarma:
              configDirectory: ../karma.config.d
              useChromeHeadless: true
        nodejs:
          testTask:
            useMocha:
              timeout: 600s

  applyDefaultHierarchyTemplate:
    common:
      groups:
        - jvmCommon:
            withJvm: true
            withAndroid: true
        - jvmCommonIos:
            withJvmCommon: true
            withIos: true
        - jvmIosWeb:
            withJvm: true
            withIos: true
            withWeb: true
        - jvmWeb:
            withJvm: true
            withWeb: true
        - androidIos:
            withAndroid: true
            withIos: true
        - androidIosWeb:
            withMobile: true
            withWeb: true
        - androidNative32:
            withAndroidNativeArm32: true
            withAndroidNativeX86: true
        - androidNative64:
            withAndroidNativeX64: true
            withAndroidNativeArm64: true
        - androidNative:
            withAndroidNative32: true
            withAndroidNative64: true
        - apple32:
            withWatchosArm32: true
            withWatchosArm64: true  # NB watchosArm64 is weird target w/ 32-bit numbers.
        - apple64:
            withIos: true
            withMacos: true
            withTvos: true
            withWatchosX64: true
            withWatchosDeviceArm64: true
            withWatchosSimulatorArm64: true
        - apple:
            withApple32: true
            withApple64: true
        - nonIos:
            withJvmCommon: true
            withWeb: true
        - nix:
            withLinux: true
            withApple: true
            withAndroidNative: true
        - posix:
            withMingw: true
            withNix: true
        - nativeNonApple:
            withMingw: true
            withUnix: true
            withLinux: true
            withAndroidNative: true
        - nativeNonAndroid:
            withApple: true
            withMingw: true
            withLinux: true
        - native:
            withNativeNonApple: true
            withNativeNonAndroid: true
        - desktop:
            withLinux: true
            withWindows: true
            withMacos: true
        - multithreaded:
            withJvmCommon: true
            withNative: true
        - jsCommon:
            withJs: true
            withWasmJs: true
        - wasm:
            withWasmJs: true
            withWasmWasi: true
        - web:
            withJsCommon: true
            withWasmWasi: true

  #  sourceSets:

  cocoapods:
    ios: { }
