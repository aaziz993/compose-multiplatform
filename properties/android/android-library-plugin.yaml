config:
  imports:
    - org.jetbrains.kotlin.gradle.plugin.mpp.KotlinAndroidTarget
    - com.android.build.api.dsl.androidLibrary
script:
  - plugins:
      - id: (libs.plugins("android.kotlin.multiplatform.library").pluginId)
  - kotlin:
      androidLibrary: |
        {
          namespace = androidNamespace
          compileSdk = libs.versions("android.compileSdk")!!.requiredVersion.toInt()  
          minSdk = libs.versions("android.minSdk")!!.requiredVersion.toInt()
        
          withJava() // enable java compilation support
          // Enable Android resource processing
          androidResources {
            enable = true
          }
        
          withHostTestBuilder {}.configure {
            isIncludeAndroidResources = true
          }
        
          withDeviceTestBuilder {
            sourceSetTreeName = "test"
          }.configure {
            instrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
            execution = "ANDROIDX_TEST_ORCHESTRATOR"
          }

          // Configure the JVM target for both Kotlin and Java sources
          compilerOptions {
            jvmTarget.set(org.jetbrains.kotlin.gradle.dsl.JvmTarget.JVM_1_8)
          }
        }
      sourceSets:
        - named: |
            ("androidHostTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs("androidx.arch.core.testing"))
              }
            }
        - named: |
            ("androidDeviceTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs("androidx.test.core"))
                implementation(libs("androidx.test.runner"))
                implementation(libs("androidx.test.ext.junit"))
                implementation(libs("androidx.test.espresso.core"))
                implementation(libs("androidx.test.rules"))
                implementation(libs("androidx.test.monitor"))
                implementation(libs("androidx.ui.test.manifest"))
                implementation(libs("mockk.android"))
                implementation(libs("androidx.ui.test.junit4.android"))
              }
            }