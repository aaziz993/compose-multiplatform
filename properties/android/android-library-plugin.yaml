config:
  imports:
    - org.jetbrains.kotlin.gradle.plugin.mpp.KotlinAndroidTarget
    - com.android.build.api.dsl.androidLibrary
script:
  - plugins:
      - id: (libs.plugins("android.kotlin.multiplatform.library").pluginId)
  - kotlin:
      androidLibrary: |
        {
          namespace = androidNamespace
          compileSdk = libs.versions("android.compileSdk").requiredVersion.toInt()
          minSdk = libs.versions("android.minSdk").requiredVersion.toInt()
          enableCoreLibraryDesugaring = true

          lint {
            abortOnError = false
            checkReleaseBuilds = false
            xmlReport = true
            xmlOutput = file("build/reports/lint-results.xml")
          }

          packaging {
            resources {
              excludes += setOf(
                "/META-INF/{AL2.0,LGPL2.1}",
              )
            }
          }

          aarMetadata {
            minCompileSdk = libs.versions("android.minSdk").requiredVersion.toInt()
          }

          // Enable java compilation support.
          withJava()

          // Enable Android resource processing
          androidResources {
            enable = true
          }

          // JVM-based unit tests.
          withHostTest {
            isIncludeAndroidResources = true
          }

          // Device/instrumented tests.
          withDeviceTest {
            instrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
          }

          // Configure the JVM target for both Kotlin and Java sources
          compilerOptions {
            jvmTarget.set(org.jetbrains.kotlin.gradle.dsl.JvmTarget.JVM_1_8)
          }
        }
      sourceSets:
        - named: |
            ("androidHostTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs["androidx.arch.core.testing"])
              }
            }
        - named: |
            ("androidDeviceTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs["androidx.test.core"])
                implementation(libs["androidx.test.runner"])
                implementation(libs["androidx.test.ext.junit"])
                implementation(libs["androidx.test.espresso.core"])
                implementation(libs["androidx.test.rules"])
                implementation(libs["androidx.test.monitor"])
                implementation(libs["androidx.ui.test.manifest"])
                implementation(libs["mockk.android"])
                implementation(libs["androidx.ui.test.junit4.android"])
              }
            }
