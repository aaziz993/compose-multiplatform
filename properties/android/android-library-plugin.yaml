config:
  imports:
    - com.android.build.api.dsl.androidLibrary
script:
  - plugins:
      - id: (libs.plugins("android.kotlin.multiplatform.library").pluginId)
  - kotlin:
      androidLibrary: |
        {
          namespace = androidNamespace
          compileSdk = libs.versions("android.compileSdk").requiredVersion.toInt()
          minSdk = libs.versions("android.minSdk").requiredVersion.toInt()

          // Optional: core library desugaring.
          enableCoreLibraryDesugaring = true

          // Packaging options.
          packaging {
            resources {
              excludes += setOf(
                "/META-INF/{AL2.0,LGPL2.1}",
                "META-INF/*.kotlin_module",
                "META-INF/*.SF",
                "META-INF/*.DSA",
                "META-INF/*.RSA",
              )
              pickFirsts += listOf(
                "META-INF/NOTICE*",
                "META-INF/LICENSE*",
                "META-INF/versions/**",
                "kotlin/**",
              )
            }
          }

          // Metadata for publishing.
          aarMetadata {
            minCompileSdk = libs.versions("android.minSdk").requiredVersion.toInt()
          }

          // Enable Java compilation.
          withJava()

          // Enable Android resources.
          androidResources {
            enable = true
          }

          // JVM-based unit tests (disabled by default unless you opt in).
          withHostTest {
            isIncludeAndroidResources = true
          }

          // Instrumented tests (opt-in).
          withDeviceTest {
            instrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
          }

          // Compiler settings.
          compilerOptions {
            jvmTarget /= libs.versions("android.jvm.target").requiredVersion.toJvmTarget()
          }
        }
      sourceSets:
        - named: |
            ("androidHostTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs["androidx.arch.core.testing"])
              }
            }
        - named: |
            ("androidDeviceTest") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs["androidx.test.core"])
                implementation(libs["androidx.test.runner"])
                implementation(libs["androidx.test.ext.junit"])
                implementation(libs["androidx.test.espresso.core"])
                implementation(libs["androidx.test.rules"])
                implementation(libs["androidx.test.monitor"])
                implementation(libs["androidx.ui.test.manifest"])
                implementation(libs["mockk.android"])
                implementation(libs["androidx.ui.test.junit4.android"])
              }
            }
