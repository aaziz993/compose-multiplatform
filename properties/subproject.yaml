imports:
  - root.yaml
config:
  imports:
    - kotlinx.benchmark.gradle.JvmBenchmarkTarget
    - org.jetbrains.kotlin.gradle.targets.js.dsl.KotlinJsTargetDsl
    - kotlinx.rpc.RpcStrictMode
    - com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar
    - org.gradle.api.file.DuplicatesStrategy
    - gradle.plugins.spotless.*
script:
  # Flatten source code directories.
  - flatten: ()
  - group: '"io.github.aaziz993"'
  - plugins:
      - id: (libs.plugins("dependencycheck").pluginId)
      - id: (libs.plugins("buildconfig").pluginId)
      - id: (libs.plugins("spotless").pluginId)
      - id: (libs.plugins("sonarqube").pluginId)
      - id: (libs.plugins("binaryCompatibilityValidator").pluginId)
      - id: (libs.plugins("ksp").pluginId)
      - id: (libs.plugins("allopen").pluginId)
      - id: (libs.plugins("noarg").pluginId)
      - id: (libs.plugins("atomicfu").pluginId)
      - id: (libs.plugins("kotlin.serialization").pluginId)
      - id: (libs.plugins("kotlinx.benchmark").pluginId)
      - id: (libs.plugins("sqldelight").pluginId)
      - id: (libs.plugins("room").pluginId)
      - id: (libs.plugins("kotlinx.rpc").pluginId)
      - id: (libs.plugins("ktorfit").pluginId)
      - id: (libs.plugins("apollo3").pluginId)
      - id: (libs.plugins("powerAssert").pluginId)
  - kotlin:
      explicitApi: ExplicitApiMode.Strict
      compilerOptions:
        allWarningsAsErrors: false
        progressiveMode: true
        suppressWarnings: false
        verbose: true
        optIn.addAll: |
          (
            "kotlin.RequiresOptIn",
            "kotlin.ExperimentalSubclassOptIn",
            "kotlin.ExperimentalStdlibApi",
            "kotlin.ExperimentalUnsignedTypes",
            "kotlin.ExperimentalUuidApi",
            "kotlin.time.ExperimentalTime",
            "kotlin.ExperimentalAtomicApi",
            "kotlin.contracts.ExperimentalContracts",
            "kotlin.experimental.ExperimentalObjCName",
            "kotlin.js.ExperimentalJsExport",
            "kotlinx.coroutines.ExperimentalCoroutinesApi",
            "kotlinx.coroutines.DelicateCoroutinesApi",
            "kotlinx.coroutines.FlowPreview",
            "kotlinx.serialization.ExperimentalSerializationApi",
            "kotlinx.serialization.InternalSerializationApi",
            "dev.whyoleg.cryptography.DelicateCryptographyApi",
          )
        freeCompilerArgs.addAll: |
          (
            "-Xignore-const-optimization-errors",
            "-Xexplicit-api=strict",
            "-Xexport-kdoc",
            "-Xinline-classes",
            "-Xwhen-guards",
            "-Xnon-local-break-continue",
            "-Xexpect-actual-classes",
            "-Xcontext-parameters",
            "-Xmulti-dollar-interpolation",
            "-Xrender-internal-diagnostic-names",
            "-Xbinary=preCodegenInlineThreshold=40"
          )
  ## Software Composition Analysis (SCA) tool that attempts to detect publicly disclosed vulnerabilities contained within a project's dependencies. It does this by determining if there is a Common Platform Enumeration (CPE) identifier for a given dependency. If found, it will generate a report linking to the associated CVE entries.
  - dependencyCheck:
      outputDirectory: '"build/reports"'
      format: '"ALL"'
  # Generating BuildConstants for any kind of Gradle projects: Java, Kotlin, Android, Groovy, etc. Designed for KTS scripts, with experimental support for Kotlin's multi-platform plugin
  - buildConfig: '{ }'
  # Can format <antlr | c | c# | c++ | css | flow | graphql | groovy | html | java | javascript | json | jsx | kotlin | less | license headers | markdown | objective-c | protobuf | python | scala | scss | shell | sql | typeScript | vue | yaml | anything> using <gradle | maven | sbt | anything>.
  - spotless:
      - java: | 
          { java ->
            java.replaceRegex("remove license header", """^\s*(//.*|/\*[\s\S]*?\*\/)\s*""", "")
            // specify license header text
            java.licenseHeader("../licenses/LICENSE_HEADER_SLASHED", "^")
            // include source files
            java.target("**/*.java")
            // uses the default importOrder configuration
            java.importOrder()
            // removes any unused imports from any of your Java classes
            java.removeUnusedImports()
            // Tells spotless to format according to the Google Style Guide
            // (https://google.github.io/styleguide/javaguide.html)
            java.googleJavaFormat().apply {
              groupArtifact("com.google.googlejavaformat:google-java-format")
              reflowLongStrings(true)
              reorderImports(true)
              formatJavadoc(false)
            }
            // fixes formatting of type annotations
            java.formatAnnotations()
            // cleanthat will refactor your code, but it may break your style: apply it before your formatter
            java.cleanthat()
          }
      - kotlin: |
          { kotlin ->
            // use ktlint with version and custom .editorconfig
            kotlin.ktlint().setEditorConfigPath("../.editorconfig")
            // remove old license header
            kotlin.replaceRegex("remove license header", """^\s*(//.*|/\*[\s\S]*?\*\/)\s*""", "")
            // specify license header text
            kotlin.licenseHeader("../licenses/LICENSE_HEADER_SLASHED", "^")
            // include source files
            kotlin.target("**/*.kt", "**/*.kts")
          }
      - kotlinGradle: |
          { kotlinGradle ->
            // use ktlint with version and custom .editorconfig
            kotlinGradle.ktlint().setEditorConfigPath("../.editorconfig")
            // remove old license header
            kotlinGradle.replaceRegex("remove license header", """^\s*(//.*|/\*[\s\S]*?\*\/)\s*""", "")
            // specify license header text
            kotlinGradle.licenseHeader("../licenses/LICENSE_HEADER_SLASHED", "^")
            // include source files
            kotlinGradle.target("**/*.gradle.kts")
          }
      - javascript: |
          { javascript ->
            // remove old license header
            javascript.replaceRegex("remove license header", """^\s*(//.*|/\*[\s\S]*?\*\/)\s*""", "")
            // specify license header text
            javascript.licenseHeader("../licenses/LICENSE_HEADER_SLASHED", "^")
            // include source files
            javascript.target("**/*.js")
          }
      - typescript: |
          { typescript ->
            // remove old license header
            typescript.replaceRegex("remove license header", """^\s*(//.*|/\*[\s\S]*?\*\/)\s*""", "")
            // specify license header text
            typescript.licenseHeader("../licenses/LICENSE_HEADER_SLASHED", "^")
            // include source files
            typescript.target("**/*.ts")
          }
      - json: | 
          { json ->
            // include source files
            json.target("**/*.json")
          }
      - yaml: |
          { yaml ->
            // specify license header text
            yaml.licenseHeader("../licenses/LICENSE_HEADER_SHARPED", """^(?!\s*#).*""")
            // include source files
            yaml.target("**/*.yaml", "**/*.yml")
          }
      - format: |
          ("xml") { xml ->
            // remove old license header
            xml.replaceRegex("remove license header", """^\s*<--[\s\S]*?-->\s*""", "")
            // specify license header text
            xml.licenseHeader("../licenses/LICENSE_HEADER_TAGGED", "^")
            // include source files
            xml.target("**/*.xml")
          }
      - format: |
          ("properties") { properties ->
            // specify license header text
            properties.licenseHeader("../licenses/LICENSE_HEADER_SHARPED", """^(?!\s*#).*""")
            // include source files
            properties.target("**/*.properties")
            // removes any extra whitespace at the beginning of lines
            properties.indentWithSpaces()
          }
      - format: |
          ("html") { html ->
            // remove old license header
            html.replaceRegex("remove license header", """^\s*<--[\s\S]*?-->\s*""", "")
            // specify license header text
            html.licenseHeader("../licenses/LICENSE_HEADER_TAGGED", "^")
            // include source files
            html.target("**/*.html")
          }
      - format: |
          ("md") { md ->
            // remove old license header
            md.replaceRegex("remove license header", """^\s*<--[\s\S]*?-->\s*""", "")
            // specify license header text
            md.licenseHeader("../licenses/LICENSE_HEADER_TAGGED", "^")
            // include source files
            md.target("**/*.md")
          }
      - format: |
          ("editconfig") { editconfig ->
            // specify license header text
            editconfig.licenseHeader("../licenses/LICENSE_HEADER_SHARPED", """^(?!\s*#).*""")
            // include source files
            editconfig.target("**/.editconfig")
            // removes any extra whitespace at the beginning of lines
            editconfig.indentWithSpaces()
          }
      - format: |
          ("gitignore") { gitignore ->
            // specify license header text
            gitignore.licenseHeader("../licenses/LICENSE_HEADER_SHARPED", """^(?!\s*#).*""")
            // include source files
            gitignore.target("**/.gitignore")
            // removes any extra whitespace at the beginning of lines
            gitignore.indentWithSpaces()
          }
      - format: |
          ("gitattributes") { gitattributes ->
            // specify license header text
            gitattributes.licenseHeader("../licenses/LICENSE_HEADER_SHARPED", """^(?!\s*#).*""")
            // include source files
            gitattributes.target("**/.gitattributes")
            // removes any extra whitespace at the beginning of lines
            gitattributes.indentWithSpaces()
          }
      - formats: |
          {
            // exclude source files
            targetExclude(
              "../licenses/LICENSE_HEADER_*",
              "**/generated-src/**",
              "**/build-*/**",
              "**/.idea/**",
              "**/.fleet/**",
              "**/.idea/**",
              "**/.gradle/**",
              "/spotless/**",
              "**/resources/**",
              "**/buildSrc/**"
            )
            // removes any extra whitespace at the end of lines
            trimTrailingWhitespace()
            // adds a newline character to the end of files content
            endWithNewline()
            // adds the ability to have spotless ignore specific portions of a project. The usage looks like the following
            toggleOffOn()
          }
  # Help developers deliver high-quality, efficient code standards that benefit the entire team or organization.
  - sonar:
      properties: |
        { properties ->
          properties.properties(
            mapOf(
                "sonar.host.url" to "https://sonarcloud.io",
                "sonar.organization" to "aaziz993",
                "sonar.projectKey" to "aaziz993_compose-multiplatform",
                "sonar.coverage.jacoco.xmlReportPaths" to "build/reports/kover/report.xml",
                "sonar.androidLint.reportPaths" to "build/reports/lint-results.xml",
            )
          )
        }
  # Api documentation engine for Kotlin.
  - dokka:
      pluginsConfiguration:
        - html:
            customStyleSheets.from: ("../dokka/style.css", "../dokka/prism.css", "../dokka/logo-styles.css")
            customAssets.from: ("../dokka/logo-icon.svg")
  # Allows dumping binary API of a JVM part of a Kotlin library that is public in the sense of Kotlin visibilities and ensures that the public binary API wasn't changed in a way that makes this change binary incompatible.
  - apiValidation:
      apiDumpDirectory: '"api-validation"'
      klib:
        enabled: true
        strictValidation: true
  # Api that you can use to develop lightweight compiler plugins. KSP provides a simplified compiler plugin API that leverages the power of Kotlin while keeping the learning curve at a minimum. Compared to KAPT, annotation processors that use KSP can run up to 2x faster.
  - ksp:
      # room
      - arg: ("room.schemaLocation", "schemas")
      - arg: ("room.incremental", "true")
      - arg: ("room.expandProjection", "true")
      - arg: ("room.generateKotlin", "true")
  # Adapts Kotlin to the requirements of those frameworks and makes classes annotated with a specific annotation and their members open
  - allOpen:
      - annotations: |
          (
            "javax.ws.rs.Path",
            "javax.enterprise.context.ApplicationScoped",
            "javax.persistence.Entity",
            "org.openjdk.jmh.annotations.State",
            // apply to ensure your benchmark classes and methods are open.
            "data.type.annotation.AllOpen",
          )
  # Generates an additional zero-argument constructor for classes with a specific annotation.
  - noArg:
      - annotations: |
          (
            "data.type.annotation.NoArg",
          )
  # Multiplatform library that provides the idiomatic and efficient way of using atomic operations in Kotlin.
  - atomicFU: '{ }'
  # Toolkit for running benchmarks for multiplatform code written in Kotlin. It is designed to work with Kotlin/JVM, Kotlin/JS, Kotlin/Native, and Kotlin/WasmJs (experimental) targets.
  - benchmark:
      reportsDir: '"build/reports"'
      targets:
        - withType<JvmBenchmarkTarget>: |
            {
              jmhVersion = "1.37"
            }
  # Generates typesafe Kotlin APIs from your SQL statements. It verifies your schema, statements, and migrations at compile-time and provides IDE features like autocomplete and refactoring which make writing and maintaining SQL simple.
  - sqldelight:
      linkSqlite: true
  # Abstraction layer over SQLite to allow for more robust database access while harnessing the full power of SQLite.
  - room:
      - schemaDirectory: ("$projectDir/schemas")
  ## Kotlin library for adding asynchronous Remote Procedure Call (RPC) services to your applications. Build your RPC with already known language constructs and nothing more!
  - rpc:
      strict:
        stateFlow: RpcStrictMode.WARNING
        sharedFlow: RpcStrictMode.WARNING
        nestedFlow: RpcStrictMode.WARNING
  ## Http client/Kotlin Symbol Processor for Kotlin Multiplatform ( Android, iOS, Js, Jvm, Linux) using KSP and Ktor clients inspired by Retrofit
  - ktorfit:
      generateQualifiedTypeName: true
  ## Strongly typed GraphQL client that generates Kotlin models for your GraphQL operations.
  - apollo:
      generateSourcesDuringGradleSync: true
  # Providing detailed failure messages with contextual information during testing.
  - powerAssert:
      functions.addAll: |
        (
          "kotlin.assert",
          "kotlin.test.assertTrue",
          "kotlin.test.assertEquals",
          "kotlin.test.assertNull",
          "kotlin.test.assertFails",
          "kotlin.test.assertFailsWith",
        )
      includedSourceSets.addAll: |
        (
          "commonMain",
          "jvmMain",
          "androidMain",
          "nativeMain",
          "jsMain",
          "wasmJsMain",
          "wasmWasiMain",
        )
  - dependencies:
      - add: ("kspCommonMainMetadata", libs("arrow.optics.ksp.plugin"))
      - add: ("kspCommonMainMetadata", libs("androidx.room.compiler"))
      - add: ("kspCommonMainMetadata", libs("ktorfit.ksp"))
      # Use import org.koin.ksp.generated.* in project.
      - add: ("kspCommonMainMetadata", libs("koin.ksp.compiler"))
      # knit
#      - testImplementation: ("org.jetbrains.kotlinx:kotlinx-knit-test")
  - tasks:
      - withType<ShadowJar>: |
          { 
            duplicatesStrategy = DuplicatesStrategy.EXCLUDE
            mergeServiceFiles()
          }
