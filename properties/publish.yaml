config:
  imports:
    - org.gradle.plugins.signing.*
    - org.gradle.api.publish.maven.MavenPublication
script:
  - plugins:
      - id: ("maven-publish")
      - id: ("signing")
      - id: (libs.plugins("vanniktech.maven.publish").pluginId)
  # publishing
  - publishing:
      repositories:
        - mavenLocal: |
            { repository ->
              repository.url = uri("build/m2")
            }
        # Something that's easy to "clean" for development not mavenLocal
        - maven: |
            { repository ->
              repository.name = "buildRepo"
              repository.url = uri("../build/repo") // root build/repo
            }
        - maven: |
            { repository ->
              repository.name = "GithubPackages"
              repository.url = uri("https://maven.pkg.github.com/aaziz993")
              repository.credentials { credentials ->
                credentials.username = sensitive("publishing.repositories.githubPackages.username")
                credentials.password = sensitive("publishing.repositories.githubPackages.password")
              }
            }
        - maven: |
            { repository ->
              repository.name = "Sonatype"
              repository.url = uri("https://oss.sonatype.org")
              repository.credentials { credentials ->
                credentials.username = sensitive("publishing.repositories.sonatype.username")
                credentials.password = sensitive("publishing.repositories.sonatype.password")
              }
            }
        - maven: |
            { repository ->
              repository.name = "SonatypeS01"
              repository.url = uri("https://s01.oss.sonatype.org")
              repository.credentials { credentials ->
                credentials.username = sensitive("publishing.repositories.sonatype.s01.username")
                credentials.password = sensitive("publishing.repositories.sonatype.s01.password")
              }
            }
        - maven: |
            { repository ->
              repository.name = "SonatypeCentral"
              repository.url = uri("https://central.sonatype.com")
              repository.credentials { credentials ->
                credentials.username = sensitive("publishing.repositories.sonatype.central.username")
                credentials.password = sensitive("publishing.repositories.sonatype.central.password")
              }
            }
        - maven: |
            { repository ->
              repository.name = "SonatypeStaging"
              repository.url = uri("https://oss.sonatype.org/service/local/staging/deploy/maven2")
              repository.credentials { credentials ->
                credentials.username = sensitive("publishing.repositories.sonatype.staging.username")
                credentials.password = sensitive("publishing.repositories.sonatype.staging.password")
              }
            }
      publications:
        - create<MavenPublication>: |
            ("jar") {
              artifactId = project.name
              groupId = project.group.toString()
              version = project.version.toString()

              pom { pom ->
                  pom.packaging = "jar"
                  pom.name /=project.name
                  pom.url /=settings.settingsProperties.license.url
                  pom.description /= project.description

                  pom.licenses { licenses ->
                      licenses.license { license ->
                          license.name /= settings.settingsProperties.license.name
                          license.url /= settings.settingsProperties.license.url
                          license.distribution /= settings.settingsProperties.license.distribution
                          license.comments /= settings.settingsProperties.license.comments
                      }
                  }

                  pom.developers { developers ->
                      developers.developer { developer ->
                          developer.id /= settings.settingsProperties.developer.id
                          developer.name /= settings.settingsProperties.developer.name
                          developer.email /= settings.settingsProperties.developer.email
                          developer.organization /= settings.settingsProperties.developer.organization
                          developer.organizationUrl /= settings.settingsProperties.developer.organizationUrl
                      }
                  }

                  pom.issueManagement { issueManagement ->
                      issueManagement.system /= "GitHub Issues"
                      issueManagement.url /= "https://github.com/aaziz993/compose-multiplatform/issues"
                  }

                  pom.scm { scm ->
                      scm.url /= settings.settingsProperties.remote.url
                      scm.connection /= settings.settingsProperties.remote.connection
                      scm.developerConnection /= settings.settingsProperties.remote.developerConnection
                      scm.tag /= settings.settingsProperties.remote.tag
                  }
              }

              // Signing.
              signing {
                  useGpgCmd()
                  useInMemoryPgpKeys(
                      sensitive("signing.gnupg.key.id"),
                      sensitive("signing.gnupg.key"),
                      sensitive("signing.gnupg.key.passphrase")
                  )

                  // Sign all publications.
                  sign(publishing.publications)

                  // Register additional gpg tasks.
                  registerGPGTasks()
              }
            }
