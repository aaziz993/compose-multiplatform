script:
  - kotlin:
      applyDefaultHierarchyTemplate: |
        {
          common {
            group("jvmAndroid") {
              withJvm()
              withAndroidTarget()
            }
            group("ios") {
              withIos()
            }
            group("watchos32") {
              withWatchosArm32()
              withWatchosArm64()  // NB watchosArm64 is weird target w/ 32-bit numbers.
            }
            group("watchos64") {
              withWatchosX64()
              withWatchosDeviceArm64()
              withWatchosSimulatorArm64()
            }
            group("macos") {
              withMacos()
            }
            group("tvos") {
              withTvos()
            }
            group("linux") {
              withLinux()
            }
            group("mingw") {
              withMingw()
            }
            group("jvmAndroidIos") {
              group("jvmAndroid")
              group("ios")
            }
            group("jvmWebIos") {
              group("jvmWeb")
              group("ios")
            }
            group("jvmWeb") {
              withJvm()
              group("web")
            }
            group("androidIos") {
              withAndroidTarget()
              group("ios")
            }
            group("androidIosWeb") {
              group("androidIos")
              group("web")
            }
            group("androidNative32") {
              withAndroidNativeArm32()
              withAndroidNativeX86()
            }
            group("androidNative64") {
              withAndroidNativeX64()
              withAndroidNativeArm64()
            }
            group("androidNative") {
              group("androidNative32")
              group("androidNative64")
            }
            group("apple32") {
              group("watchos32")
            }
            group("apple64") {
              group("ios")
              group("macos")
              group("tvos")
              group("watchos64")
            }
            group("apple") {
              group("apple32")
              group("apple64")
            }
            group("jvmAndroidWeb") {
              group("jvmAndroid")
              group("jvmWeb")
            }
            group("nix") {
              group("androidNative")
              group("apple")
              group("linux")
            }
            group("posix") {
              group("nix")
              group("mingw")
            }
            group("nativeAndroidLinuxMingw") {
              group("androidNative")
              group("linux")
              group("mingw")
            }
            group("nativeAppleLinuxMingw") {
              group("apple")
              group("linux")
              group("mingw")
            }
            group("desktop") {
              group("linux")
              group("mingw")
              group("macos")
            }
            group("native") {
              group("posix")
              group("nativeAndroidLinuxMingw")
              group("nativeAppleLinuxMingw")
              group("desktop")
            }
            group("multithreaded") {
              group("jvmAndroid")
              group("native")
            }
          }
        }

      sourceSets.apply: |
        {
          // Trick to integrate androidTarget with default hierarchy template when used new android kotlin multiplatform library plugin.
          pluginManager.withPlugin("com.android.kotlin.multiplatform.library") {
            val androidMain by getting
            val androidHostTest by getting
            val androidDeviceTest by getting

            val jvmAndroidMain by getting
            val jvmAndroidTest by getting

            androidMain.dependsOn(jvmAndroidMain)
            androidHostTest.dependsOn(jvmAndroidTest)
            androidDeviceTest.dependsOn(jvmAndroidTest)

            val androidIosMain by getting
            val androidIosTest by getting

            androidMain.dependsOn(androidIosMain)
            androidHostTest.dependsOn(androidIosTest)
            androidDeviceTest.dependsOn(androidIosTest)
          }
        }
