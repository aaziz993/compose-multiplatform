config:
  imports:
    - org.jetbrains.kotlin.gradle.ExperimentalWasmDsl
    - org.jetbrains.kotlin.gradle.targets.js.webpack.KotlinWebpackConfig
    - org.jetbrains.kotlin.gradle.targets.js.dsl.KotlinWasmJsTargetDsl
script:
  - '@file:OptIn': (ExperimentalWasmDsl::class)
  - kotlin:
      wasmJs: |
        {
          browser()
          nodejs()
        }
      targets:
        - withType<KotlinWasmJsTargetDsl>: |
            {
              compilerOptions {
                // WASM does NOT support -Xexport-kdoc or JS-specific flags
                freeCompilerArgs.addAll(listOf(
                  "-Xpartial-linkage-loglevel=ERROR",
                ))
              }
            }
      sourceSets:
        - named: |
            ("wasmJsMain") { sourceSet ->
              sourceSet.dependencies {
                implementation(libs("kotlinWrappers")["browser"])
              }
            }
